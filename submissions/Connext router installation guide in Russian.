Гайд по установке роутера Connext.

Требования к серверу:
8 GB Оперативной памяти
30GB Жёсткий диск
Redis (не обязательно, так как он используется в докере по умолчанию)
1. Обновите и установите пакеты

sudo apt update && sudo apt upgrade -y
apt install git sudo unzip wget curl htop -y

2. Установите Docker и Docker-compose

curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
rm get-docker.sh

curl -SL https://github.com/docker/compose/releases/download/v2.5.0/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose

3. Установите маршрутизатор

cd $HOME
mkdir -p connext && cd connext
git clone https://github.com/connext/nxtp-router-docker-compose.git
cd $HOME/connext/nxtp-router-docker-compose
git checkout amarok

4. Получить последнюю версию маршрутизатора

LATEST=”$(curl -fsSLI -o /dev/null -w %{url_effective} https://github.com/connext/nxtp/releases/latest | awk ‘BEGIN{FS=”v”} {print $2}’)” && echo $LATEST
docker pull ghcr.io/connext/router:$LATEST

5. Создайте файлы .env, config и key:

cp .env.example .env
wget -O config.json https://raw.githubusercontent.com/martynovalek/NXTP-Router-install/main/config.json
wget -O key.yaml https://raw.githubusercontent.com/martynovalek/NXTP-Router-install/main/key.yaml

6. Удалить файлы exaples:

rm config.example.json .env.example key.example.yaml

7. Установочный key.yamlфайл

Вставьте свой закрытый ключ из Metamask вместо <your_key>

PRIVATE_KEY=”<your_key>”

Используйте команду ниже, чтобы записать ключ в key.yamlфайл

sed -i ‘s/your_privatekey/’$PRIVATE_KEY’/g’ key.yaml

8. Зарегистрируйтесь на infura.io и создайте новый проект:


Выбираем сеть Ethereum и даём название своему проекту.


Далее откройте настройки.


И скопируйте ID вашего проекта.


9. Установочный config.jsonфайл.

Вставьте свой идентификатор проекта из Infura в приведенную ниже команду вместо «XXXX».

PROJECT_ID=”XXXX”

sed -i ‘s/224d26fcdc02495c921bb5d74702002e/’$PROJECT_ID’/g’ $HOME/connext/nxtp-router-docker-compose/config.json

10. Установочный .envфайл

sed -i ‘s/latest/’$LATEST’/g’ .env

11. Запустите маршрутизатор.
Убедитесь, что ваш текущий каталог$HOME/connext/nxtp-router-docker-compose

docker-compose down
docker-compose up -d

12. Проверить логи:

cd $HOME/connext/nxtp-router-docker-compose
docker logs — follow — tail 100 router

Обновить версию роутера:
sed -i.bak -e “s/$CURRENT/$NEW/” $HOME/connext/nxtp-router-docker-compose/.env

Убедитесь .env, что файл имеет новую версию:

cat $HOME/connext/nxtp-router-docker-compose/.env | grep ROUTER_VERSION | awk -F ‘=’ ‘{print$2}’

Теперь обновите стек и проверьте логи:

cd $HOME/connext/nxtp-router-docker-compose
docker-compose down
docker-compose pull
docker-compose up -d
docker logs — follow — tail 100 router

Дополнительные команды.
Перезапустите Докер:

cd $HOME/connext/nxtp-router-docker-compose
docker-compose restart

Проверьте текущую версию роутера:

CURRENT=$(cat $HOME/connext/nxtp-router-docker-compose/.env | grep ROUTER_VERSION | awk -F ‘=’ ‘{print$2}’) && echo $CURRENT

Узнать последнюю версию роутера:

NEW=”$(curl -fsSLI -o /dev/null -w %{url_effective} https://github.com/connext/nxtp/releases/latest | awk ‘BEGIN{FS=”v”} {print $2}’)” && echo $NEW

Удалить маршрутизатор и все, что с ним связано:
cd ~/connext/nxtp-router-docker-compose
docker-compose down
docker system prune -a
cd && rm -rf $HOME/connext
